---
layout: post
title: "우분투 부팅 속도 최적화"
parent_category: study
category: programming
---

# systemd-analyze 및 부팅 최적화 명령어 레퍼런스

## 📊 systemd-analyze 명령어

### 1. 기본 부팅 시간 분석
```bash
# 전체 부팅 시간 확인
systemd-analyze

# 출력 예시:
# Startup finished in 18.075s (firmware) + 14.225s (loader) + 3.195s (kernel) + 59.227s (userspace) = 1min 34.723s
```
- **firmware**: UEFI/BIOS 초기화 시간
- **loader**: 부트로더(GRUB) 시간
- **kernel**: 커널 로딩 시간
- **userspace**: systemd 및 서비스 시작 시간

### 2. 서비스별 시작 시간 (느린 순)
```bash
# 모든 서비스의 시작 시간 표시
systemd-analyze blame

# 상위 20개만 보기
systemd-analyze blame | head -20

# 특정 서비스 검색
systemd-analyze blame | grep postgresql
```

### 3. 크리티컬 체인 분석
```bash
# 부팅 병목 지점 찾기 (의존성 체인)
systemd-analyze critical-chain

# 특정 서비스의 크리티컬 체인
systemd-analyze critical-chain NetworkManager.service
```

### 4. 부팅 타임라인 시각화
```bash
# SVG 그래프로 부팅 프로세스 시각화
systemd-analyze plot > boot_timeline.svg

# 브라우저에서 열기
xdg-open boot_timeline.svg
```

### 5. 서비스 검증
```bash
# 서비스 설정 파일 검증
systemd-analyze verify NetworkManager.service

# 모든 유닛 파일 검증
systemd-analyze verify
```

### 6. 보안 분석
```bash
# 서비스 보안 점수 확인
systemd-analyze security

# 특정 서비스 보안 분석
systemd-analyze security postgresql@16-main.service
```

### 7. 설정 파일 확인
```bash
# 실제 적용되는 설정 확인 (병합된 결과)
systemd-analyze cat-config systemd/journald.conf
```

---

## 🔧 systemctl 서비스 관리 명령어

### 서비스 활성화/비활성화
```bash
# 서비스 비활성화 (부팅 시 자동 시작 안 함)
sudo systemctl disable [서비스명]

# 서비스 활성화 (부팅 시 자동 시작)
sudo systemctl enable [서비스명]

# 서비스 마스크 (완전히 차단, 수동 시작도 불가)
sudo systemctl mask [서비스명]

# 마스크 해제
sudo systemctl unmask [서비스명]
```

### 서비스 시작/중지
```bash
# 서비스 즉시 시작
sudo systemctl start [서비스명]

# 서비스 중지
sudo systemctl stop [서비스명]

# 서비스 재시작
sudo systemctl restart [서비스명]

# 서비스 상태 확인
systemctl status [서비스명]
```

### 서비스 상태 조회
```bash
# 서비스가 활성화되어 있는지 확인
systemctl is-enabled [서비스명]

# 서비스가 실행 중인지 확인
systemctl is-active [서비스명]

# 모든 실행 중인 서비스 목록
systemctl list-units --type=service --state=running

# 활성화된 모든 서비스 목록
systemctl list-unit-files --type=service --state=enabled
```

---

## 📝 journalctl 저널 로그 관리

### 로그 조회
```bash
# 전체 로그 보기
journalctl

# 최근 로그만 보기
journalctl -n 50        # 최근 50줄
journalctl --since today
journalctl --since "1 hour ago"

# 특정 서비스 로그
journalctl -u NetworkManager.service

# 실시간 로그 추적 (tail -f와 유사)
journalctl -f

# 부팅별 로그
journalctl --list-boots  # 부팅 목록
journalctl -b 0          # 현재 부팅
journalctl -b -1         # 이전 부팅
```

### 로그 정리
```bash
# 디스크 사용량 확인
journalctl --disk-usage

# 크기 기준으로 정리
sudo journalctl --vacuum-size=100M

# 시간 기준으로 정리
sudo journalctl --vacuum-time=1week
sudo journalctl --vacuum-time=30d

# 파일 개수 기준으로 정리
sudo journalctl --vacuum-files=5

# 모든 로그 삭제 (주의!)
sudo journalctl --rotate
sudo journalctl --vacuum-time=1s
```

### 로그 검색
```bash
# 에러 메시지만 보기
journalctl -p err

# 우선순위 레벨:
# 0: emerg   - 시스템 사용 불가
# 1: alert   - 즉시 조치 필요
# 2: crit    - 심각한 상황
# 3: err     - 에러
# 4: warning - 경고
# 5: notice  - 정상이지만 중요
# 6: info    - 정보
# 7: debug   - 디버그

# 특정 문자열 검색
journalctl | grep "error"

# 커널 메시지만
journalctl -k
```

---

## ⚙️ journald.conf 설정 파일

### 설정 파일 위치
```bash
# 메인 설정 파일
/etc/systemd/journald.conf

# 드롭인 설정 (권장)
/etc/systemd/journald.conf.d/*.conf
```

### 주요 설정 옵션

#### 저장 관련
```ini
[Journal]
# 저장 위치
Storage=persistent    # /var/log/journal에 영구 저장
Storage=volatile      # /run/log/journal에 임시 저장 (재부팅 시 삭제)
Storage=auto          # 자동 (persistent 우선)

# 압축
Compress=yes          # 압축 활성화 (권장)
```

#### 크기 제한
```ini
# 시스템 전체 로그 최대 크기
SystemMaxUse=100M     # 100MB로 제한

# 개별 로그 파일 크기
SystemMaxFileSize=10M # 파일당 10MB

# 파일 개수 제한
SystemMaxFiles=10     # 최대 10개 파일
```

#### 보관 기간
```ini
# 최대 보관 시간
MaxRetentionSec=1week   # 1주일
MaxRetentionSec=1month  # 1개월
MaxRetentionSec=1year   # 1년

# 개별 파일 보관 기간
MaxFileSec=1day       # 하루마다 새 파일 생성
```

#### 성능 관련
```ini
# 동기화 간격 (디스크 쓰기)
SyncIntervalSec=5m    # 5분마다 동기화 (기본값)
SyncIntervalSec=1m    # 1분 (더 안전하지만 느림)

# Rate limiting (로그 폭주 방지)
RateLimitIntervalSec=30s
RateLimitBurst=10000
```

### 설정 적용 방법
```bash
# 1. 설정 파일 편집
sudo nano /etc/systemd/journald.conf

# 2. 저널 서비스 재시작
sudo systemctl restart systemd-journald

# 3. 설정 확인
systemd-analyze cat-config systemd/journald.conf
```

---

## 🚀 부팅 최적화 체크리스트

### 1단계: 분석
```bash
# 현재 부팅 시간 확인
systemd-analyze

# 느린 서비스 찾기
systemd-analyze blame | head -20

# 병목 지점 확인
systemd-analyze critical-chain
```

### 2단계: 불필요한 서비스 비활성화
```bash
# 네트워크 대기 서비스 (데스크톱에서 불필요)
sudo systemctl disable NetworkManager-wait-online.service

# 파일시스템 검사 (일반적으로 불필요)
sudo systemctl disable e2scrub_reap.service
sudo systemctl disable e2scrub_all.timer

# 부팅 스플래시 화면
sudo systemctl disable plymouth.service
sudo systemctl mask plymouth-quit-wait.service

# 사용하지 않는 데이터베이스
sudo systemctl disable postgresql@16-main.service
sudo systemctl disable mysql.service
```

### 3단계: 저널 최적화
```bash
# 저널 크기 제한 설정
sudo nano /etc/systemd/journald.conf
# SystemMaxUse=100M
# MaxRetentionSec=1week

# 저널 재시작
sudo systemctl restart systemd-journald

# 오래된 로그 정리
sudo journalctl --vacuum-time=1week
```

### 4단계: 재부팅 및 확인
```bash
# 재부팅
sudo reboot

# 재부팅 후 확인
systemd-analyze
systemd-analyze blame | head -20
```

---

## 📋 자주 사용하는 명령어 조합

### 부팅 시간 전후 비교
```bash
# 최적화 전
systemd-analyze > boot_before.txt
systemd-analyze blame > blame_before.txt

# 최적화 후 (재부팅 후)
systemd-analyze > boot_after.txt
systemd-analyze blame > blame_after.txt

# 비교
diff boot_before.txt boot_after.txt
```

### 특정 서비스 완전 비활성화
```bash
# 1. 중지
sudo systemctl stop [서비스명]

# 2. 비활성화
sudo systemctl disable [서비스명]

# 3. 마스크 (선택사항, 완전 차단)
sudo systemctl mask [서비스명]

# 4. 확인
systemctl status [서비스명]
```

### PostgreSQL 수동 관리
```bash
# 필요할 때만 시작
sudo systemctl start postgresql@16-main.service

# 사용 후 중지
sudo systemctl stop postgresql@16-main.service

# 상태 확인
systemctl status postgresql@16-main.service
```

---

## 🔄 원상복구 방법

### 서비스 다시 활성화
```bash
# 비활성화한 서비스 다시 활성화
sudo systemctl enable [서비스명]

# 마스크 해제
sudo systemctl unmask [서비스명]

# 즉시 시작
sudo systemctl start [서비스명]
```

### 저널 설정 원복
```bash
# 백업 파일이 있다면
sudo cp /etc/systemd/journald.conf.backup /etc/systemd/journald.conf

# 또는 기본값으로 (모두 주석 처리)
sudo nano /etc/systemd/journald.conf
# [Journal] 섹션의 모든 설정을 # 으로 주석 처리

# 재시작
sudo systemctl restart systemd-journald
```

---

## ⚠️ 주의사항

1. **서비스 비활성화 전 확인**
   - 해당 서비스가 무엇을 하는지 확인
   - 의존하는 다른 서비스가 있는지 확인
   ```bash
   systemctl list-dependencies [서비스명]
   ```

2. **백업**
   - 설정 변경 전 항상 백업
   ```bash
   sudo cp /etc/systemd/journald.conf /etc/systemd/journald.conf.backup
   ```

3. **재부팅 필수**
   - 대부분의 부팅 최적화는 재부팅 후 적용됨
   - 재부팅 전에는 효과를 확인할 수 없음

4. **서버 환경 주의**
   - 서버 환경에서는 NetworkManager-wait-online 등이 필요할 수 있음
   - 데스크톱 환경에서만 안전하게 비활성화