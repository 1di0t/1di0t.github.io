---
layout: post
title: "ìš°ë¶„íˆ¬ ì €ë„ ì •ë¦¬ë¥¼ í†µí•œ ë¶€íŒ… ì‹œê°„ ë‹¨ì¶•"
parent_category: study
category: programming
---

ëª…ë ¹ì–´ë¡œ ì €ë„ ì„¤ì •í•˜ê¸° (íŒŒì¼ ìœ„ì¹˜ ëª°ë¼ë„ ë¨)
ë°©ë²• 1: í•œ ì¤„ ëª…ë ¹ì–´ë¡œ ì„¤ì • íŒŒì¼ ìžë™ ìƒì„±
ì €ëŠ” ì˜µì…˜ B (100MB, 1ì£¼ì¼) ì„¤ì •ìœ¼ë¡œ ì˜ˆì‹œë¥¼ ë“¤ê² ìŠµë‹ˆë‹¤.
ì„¤ì • íŒŒì¼ ìžë™ ìƒì„± ëª…ë ¹ì–´:
# ë””ë ‰í† ë¦¬ ìƒì„± + ì„¤ì • íŒŒì¼ ìƒì„±ì„ í•œ ë²ˆì—
sudo mkdir -p /etc/systemd/journald.conf.d/ && sudo tee /etc/systemd/journald.conf.d/00-journal-size.conf > /dev/null <<EOF
[Journal]
# ì €ë„ ìµœëŒ€ í¬ê¸°ë¥¼ 100MBë¡œ ì œí•œ
SystemMaxUse=100M

# 1ì£¼ì¼ ì´ìƒ ëœ ë¡œê·¸ëŠ” ìžë™ ì‚­ì œ
MaxRetentionSec=1week

# ê°œë³„ ì €ë„ íŒŒì¼ í¬ê¸° 10MBë¡œ ì„¤ì •
SystemMaxFileSize=10M

# ì‹œìŠ¤í…œì— ìµœì†Œ 500MB ì—¬ìœ  ê³µê°„ í™•ë³´
SystemKeepFree=500M
EOF
ì´ ëª…ë ¹ì–´ëŠ”:
/etc/systemd/journald.conf.d/ ë””ë ‰í† ë¦¬ë¥¼ ë§Œë“¤ê³ 
00-journal-size.conf íŒŒì¼ì„ ìƒì„±í•˜ê³ 
ì„¤ì • ë‚´ìš©ì„ ìžë™ìœ¼ë¡œ ìž‘ì„±í•©ë‹ˆë‹¤
íŒŒì¼ ìœ„ì¹˜ë¥¼ ëª°ë¼ë„ ë©ë‹ˆë‹¤!
ë°©ë²• 2: ë‹¤ë¥¸ ì˜µì…˜ë“¤
ì˜µì…˜ A: ë³´ìˆ˜ì  (200MB, 2ì£¼ì¼)
sudo mkdir -p /etc/systemd/journald.conf.d/ && sudo tee /etc/systemd/journald.conf.d/00-journal-size.conf > /dev/null <<EOF
[Journal]
SystemMaxUse=200M
MaxRetentionSec=2week
SystemKeepFree=500M
EOF
ì˜µì…˜ C: ê³µê²©ì  (50MB, 3ì¼)
sudo mkdir -p /etc/systemd/journald.conf.d/ && sudo tee /etc/systemd/journald.conf.d/00-journal-size.conf > /dev/null <<EOF
[Journal]
SystemMaxUse=50M
MaxRetentionSec=3day
SystemMaxFileSize=8M
SystemKeepFree=500M
EOF
ë°©ë²• 3: ì„¤ì • í™•ì¸ ëª…ë ¹ì–´
ì„¤ì • íŒŒì¼ì´ ìž˜ ë§Œë“¤ì–´ì¡ŒëŠ”ì§€ í™•ì¸:
# ìƒì„±ëœ íŒŒì¼ ë‚´ìš© ë³´ê¸°
cat /etc/systemd/journald.conf.d/00-journal-size.conf
ë˜ëŠ”
# ì ìš©ë  ì „ì²´ ì„¤ì • ë³´ê¸° (ê¸°ë³¸ê°’ + ì»¤ìŠ¤í…€ ì„¤ì • í•©ì¹œ ê²ƒ)
systemd-analyze cat-config systemd/journald.conf
ì „ì²´ ì ìš© ê³¼ì • (ë³µì‚¬-ë¶™ì—¬ë„£ê¸°ìš©)
ðŸŽ¯ ì¶”ì²œ: ì˜µì…˜ B (100MB, 1ì£¼ì¼) ì™„ì „ ìžë™í™”
ë‹¤ìŒ ëª…ë ¹ì–´ë“¤ì„ ìˆœì„œëŒ€ë¡œ í•˜ë‚˜ì”© ë³µì‚¬í•´ì„œ í„°ë¯¸ë„ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”:
# 1ë‹¨ê³„: ì„¤ì • íŒŒì¼ ìƒì„±
sudo mkdir -p /etc/systemd/journald.conf.d/ && sudo tee /etc/systemd/journald.conf.d/00-journal-size.conf > /dev/null <<'EOF'
[Journal]
SystemMaxUse=100M
MaxRetentionSec=1week
SystemMaxFileSize=10M
SystemKeepFree=500M
EOF
# 2ë‹¨ê³„: ì„¤ì • íŒŒì¼ í™•ì¸
cat /etc/systemd/journald.conf.d/00-journal-size.conf
# 3ë‹¨ê³„: í˜„ìž¬ ì €ë„ í¬ê¸° í™•ì¸ (ë³€ê²½ ì „)
journalctl --disk-usage
# 4ë‹¨ê³„: journald ìž¬ì‹œìž‘ (ì„¤ì • ì ìš©)
sudo systemctl restart systemd-journald
# 5ë‹¨ê³„: ê¸°ì¡´ ëŒ€ìš©ëŸ‰ ë¡œê·¸ ì¦‰ì‹œ ì •ë¦¬
sudo journalctl --vacuum-size=100M
# 6ë‹¨ê³„: ì •ë¦¬ í›„ ì €ë„ í¬ê¸° í™•ì¸
journalctl --disk-usage
# 7ë‹¨ê³„: ë‹¤ìŒ ë¶€íŒ…ì—ì„œ íš¨ê³¼ í™•ì¸ìš©
echo "ì„¤ì • ì™„ë£Œ! ë‹¤ìŒ ë¶€íŒ… ì‹œ 'systemd-analyze blame' ëª…ë ¹ì–´ë¡œ ë¶€íŒ… ì‹œê°„ì„ í™•ì¸í•˜ì„¸ìš”."
ì„¤ì • ë˜ëŒë¦¬ê¸° (ëª…ë ¹ì–´ í•œ ì¤„)
ë§Œì•½ ì„¤ì •ì„ ì›ëž˜ëŒ€ë¡œ ë˜ëŒë¦¬ê³  ì‹¶ë‹¤ë©´:
# ì„¤ì • íŒŒì¼ ì‚­ì œ + journald ìž¬ì‹œìž‘
sudo rm -f /etc/systemd/journald.conf.d/00-journal-size.conf && sudo systemctl restart systemd-journald
ì˜ˆìƒ ê²°ê³¼
ë³€ê²½ ì „:
$ journalctl --disk-usage
Archived and active journals take up 538.2M in the file system.
ë³€ê²½ í›„:
$ journalctl --disk-usage
Archived and active journals take up 96.0M in the file system.
ë‹¤ìŒ ë¶€íŒ… ì‹œ:
$ systemd-analyze
Startup finished in 18.174s (firmware) + 9.215s (loader) + 3.227s (kernel) + 30s (userspace) = 1min
(ê¸°ì¡´ 1ë¶„ 37ì´ˆ â†’ ì•½ 1ë¶„ìœ¼ë¡œ ë‹¨ì¶•)
ì¶”ê°€ ìœ ìš©í•œ ëª…ë ¹ì–´
ì €ë„ ìƒíƒœ í•œëˆˆì— ë³´ê¸°
# í˜„ìž¬ ì €ë„ ì„¤ì • í™•ì¸
journalctl --header

# ì €ë„ í¬ê¸°
journalctl --disk-usage

# ì €ë„ì´ ì •ìƒì¸ì§€ í™•ì¸
sudo journalctl --verify
íŠ¹ì • ë¶€íŒ… ë¡œê·¸ë§Œ ì •ë¦¬
# í˜„ìž¬ ë¶€íŒ… ì œì™¸í•˜ê³  ì´ì „ ë¶€íŒ… ë¡œê·¸ë§Œ ì‚­ì œ
sudo journalctl --vacuum-time=0
ë¡œê·¸ ì¦‰ì‹œ í™•ì¸
# ìµœê·¼ ì—ëŸ¬ ë¡œê·¸ 10ì¤„
journalctl -p err -n 10

# í˜„ìž¬ ë¶€íŒ… ë¡œê·¸
journalctl -b

# ì‹¤ì‹œê°„ ë¡œê·¸ ëª¨ë‹ˆí„°ë§
journalctl -f
íŒŒì¼ ìœ„ì¹˜ë¥¼ ì°¾ëŠ” ëª…ë ¹ì–´ (ì°¸ê³ ìš©)
ë‚˜ì¤‘ì— ì„¤ì • íŒŒì¼ ìœ„ì¹˜ë¥¼ ìžŠì–´ë²„ë ¸ë‹¤ë©´:
# journald ê´€ë ¨ ëª¨ë“  ì„¤ì • íŒŒì¼ ì°¾ê¸°
find /etc -name "*journald*" 2>/dev/null
ë˜ëŠ”
# ì ìš©ëœ ì„¤ì • ì „ì²´ ë³´ê¸° (ì–´ë””ì— ìžˆëŠ”ì§€ë„ í‘œì‹œë¨)
systemd-analyze cat-config systemd/journald.conf
ìš”ì•½: ê°€ìž¥ ì‰¬ìš´ ë°©ë²•
3ë‹¨ê³„ë§Œ ê¸°ì–µí•˜ì„¸ìš”: 1ï¸âƒ£ ì„¤ì • íŒŒì¼ ìƒì„± (ìœ„ì˜ ë³µì‚¬-ë¶™ì—¬ë„£ê¸° ëª…ë ¹ì–´)
sudo mkdir -p /etc/systemd/journald.conf.d/ && sudo tee /etc/systemd/journald.conf.d/00-journal-size.conf > /dev/null <<'EOF'
[Journal]
SystemMaxUse=100M
MaxRetentionSec=1week
EOF
2ï¸âƒ£ ì ìš©
sudo systemctl restart systemd-journald
3ï¸âƒ£ ê¸°ì¡´ ë¡œê·¸ ì •ë¦¬
sudo journalctl --vacuum-size=100M